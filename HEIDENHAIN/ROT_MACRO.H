0  BEGIN PGM ROT_MACRO MM 
1  FN 20: WAIT FOR  SYNC
2  FN 0: Q1 =+0
3  FN 0: Q2 =+0
4  ; 
5  ;DATUM SHIFT BEFORE ROTATION
6  ;Q11 = X
7  ;Q12 = Y
8  ;Q13 = Z
9  ; 
10 ;ROTATION ANGLE
11 ;Q10 = A
12 ; 
13 ;CENTER OF ROTATION AXIS
14 FN 0: Q31 =+0 ;X
15 FN 0: Q32 =+0 ;Y
16 FN 0: Q33 =+0 ;Z
17 ; 
18 ;READ ACTIVE ORIGIN
19 FN 18: SYSREAD Q5 = ID530 NR1
20 ;
21 ;READ ORIGIN COORDINATES
22 FN 18: SYSREAD Q1 = ID507 NRQ5 IDX1 ;X
23 FN 18: SYSREAD Q2 = ID507 NRQ5 IDX2 ;Y
24 FN 18: SYSREAD Q3 = ID507 NRQ5 IDX3 ;Z
25 ; 
26 ;CALCULATE DIFFERENCE BETWEEN ROTATION AXIS AND POINT
27 Q11 = Q1 - Q31 + Q11
28 Q12 = Q2 - Q32 + Q12
29 Q13 = Q3 - Q33 + Q13
30 ; 
31 FN 3: Q10 =+Q10 * -1
32 ;CALCULATE SHIFT WITH ANGLE
33 Q21 = Q11 ;X
34 Q22 = ( Q12 * COS Q10 ) - ( Q13 * SIN Q10 ) ;Y
35 Q23 = ( Q13 * COS Q10 ) + ( Q12 * SIN Q10 ) ;Z
36 ;
37 ;CALCULATE DATUM SHIFT
38 Q51 = Q21
39 Q52 = Q22 + Q32
40 Q53 = Q23 + Q33
41 ;
42 ;WRITE ORIGIN
43 FN 17: SYSWRITE ID 507 NR9 IDX1 =+Q51
44 FN 17: SYSWRITE ID 507 NR9 IDX2 =+Q52
45 FN 17: SYSWRITE ID 507 NR9 IDX3 =+Q53
46 FN 20: WAIT FOR  SYNC
47 ;
48 ;NACTIVATE ORIGIN
49 CYCL DEF 247 BEZUGSPUNKT SETZEN ~
    Q339=+9    ;BEZUGSPUNKT-NUMMER
50 END PGM ROT_MACRO MM 
